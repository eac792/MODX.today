!function(a,b){b.fieldTypes.video=function(c,d){window.googleApiClientReady=function(){gapi.client.setApiKey("AIzaSyB0dw388ateBJGR-wIGxPTWtJUmDx55gKw"),gapi.client.load("youtube","v3",e.apiClientReady)};var e={apiInserted:!1,apiLoaded:!1};return e.init=function(){d.value&&this.selectVideo(d.value),d.video_id&&this.selectVideo(d.video_id),this.apiInserted||(a("body").append('<script src="https://apis.google.com/js/client.js?onload=googleApiClientReady"></script>'),this.apiInserted=!0),c.find(".contentblocks-field-delete-video").on("click",function(a){a.preventDefault(),c.find(".video_id").val(""),c.find(".contentblocks-field-video-preview").empty(),c.removeClass("hasVideo"),b.fireChange()}),c.find(".contentblocks-field-video-link").on("change",function(){var c=a(this).val(),d=/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/,f=c.match(d);f&&11==f[2].length&&(a(this).val(""),e.selectVideo(f[2]),b.fireChange())}).on("keyup",function(){var b=a(this);setTimeout(function(){b.trigger("change")},100)}),c.find(".contentblocks-field-video-choose").on("click",function(c){if(c.preventDefault(),!e.apiLoaded)return void b.alert(_("contentblocks.video.youtube_not_loaded"));var d=tmpl("contentblocks-modal-video",{});b.openModal("Choose Video",d,{initCallback:function(c){c.addClass("contentblocks-modal-video");var d=c.find(".contentblocks-modal-content").css("maxHeight").slice(0,-2);d-=85,c.find(".contentblocks-modal-scrollable-area").css("maxHeight",d+"px");var f=c.find("form"),g=f.find(".query"),h=c.find(".youtube-search-results"),i=c.find(".contentblocks-search-results-more");i.hide(),f.on("submit",function(c){c.preventDefault();var d=g.val(),f=gapi.client.youtube.search.list({q:d,part:"id,snippet",maxResults:12,type:"video",videoEmbeddable:!0});f.execute(function(c){if(c.error)h.html('<p class="error">'+_("contentblocks.video.api_error",{message:c.error.message,code:c.error.code})+"</p>"),i.hide();else{var d=[];a.each(c.items,function(a,b){b.snippet.publishedAt=new Date(b.snippet.publishedAt).format(MODx.config.manager_date_format),d.push(tmpl("contentblocks-field-video-item",b))}),h.html(d.join("")),c.result.nextPageToken&&i.data("token",c.result.nextPageToken).show(),h.find("li").on("click",function(){var c=a(this).data("video_id");""!=c&&(b.closeModal(),e.selectVideo(c),b.fireChange())})}})}),i.on("click",function(){var c=g.val(),d=i.data("token"),f=gapi.client.youtube.search.list({q:c,part:"id,snippet",maxResults:12,type:"video",videoEmbeddable:!0,pageToken:d});f.execute(function(c){if(c.error)h.append('<p class="error">'+_("contentblocks.video.api_error",{message:c.error.message,code:c.error.code})+"</p>");else{var d=[];a.each(c.items,function(a,b){b.snippet.publishedAt=new Date(b.snippet.publishedAt).format(MODx.config.manager_date_format),d.push(tmpl("contentblocks-field-video-item",b))}),d=d.join(""),h.append(d),c.result.nextPageToken&&i.data("token",c.result.nextPageToken).show(),h.find("li").on("click",function(){var c=a(this).data("video_id");""!=c&&(b.closeModal(),e.selectVideo(c),b.fireChange())})}})})}})})},e.selectVideo=function(a){c.addClass("hasVideo"),c.find(".video_id").val(a);var b=c.find(".contentblocks-field-video-preview");b.html('<iframe class="youtube-player" src="https://www.youtube.com/embed/'+a+'" frameborder="0">')},e.apiClientReady=function(){e.apiLoaded=!0},e.getData=function(){return{value:c.find(".video_id").val()}},e}}(vcJquery,ContentBlocks);
//# sourceMappingURL=video-min.js.map